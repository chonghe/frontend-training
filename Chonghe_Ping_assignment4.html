<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Assignment4</title>
</head>

<body>
    </head>

    <body>
        <input type="text" id="inputTodoField" />
        <button id="addTodoBtn">Add</button>
        <div id="content"></div>
    </body>
    <script src="todoApp.js"></script>
    <script>
        //get list from api
        let content = document.querySelector("#content");
        let ul = document.createElement('ul');

        content.appendChild(ul);

        // todoApi.getAllTodos().then(data => {
        //     data.todos.map(item => {
        //         let li = document.createElement("li");
        //         ul.appendChild(li);
        //         li.innerHTML = item.content;
        //         item.isCompleted ? li.style.color = "green" : li.style.color = "red";
        //         // li.innerHTML = item.content + " " + "(" + (item.isCompleted ? '✓' : 'X') + ")";
        //     })
        // });

        function getList() {
            todoApi.getAllTodos().then(data => {
                data.todos.map(item => {
                    let li = document.createElement("li");
                    ul.appendChild(li);
                    li.innerHTML = item.content;
                    item.isCompleted ? li.style.color = "green" : li.style.color = "red";
                    // li.innerHTML = item.content + " " + "(" + (item.isCompleted ? '✓' : 'X') + ")";
                })
            });
        };
        getList()

        //add item on list by api
        let inputTodoField = document.querySelector('#inputTodoField');
        let btn = document.querySelector('button');
        let _that = this;
        btn.onclick = function() {
            let todo = {
                content: inputTodoField.value,
                isCompleted: false
            }
            todoApi.addTodo(todo).then(msg => {
                if (msg = 'succeed') {
                    let uul = _that.content.childNodes.item(0);
                    //console.log(uul);
                    let li = document.createElement("li");
                    uul.appendChild(li);
                    li.innerHTML = todo.content;
                    todo.isCompleted ? li.style.color = "green" : li.style.color = "red";
                }
            });
        };

        //modify item status


        //delete item on list
        let uul = content.childNodes.item(0);
        let lis = ul.childNodes;
        console.log(lis);
        // Array.from(lis).forEach(it => {
        //     console.log(entry);
        // })
        lis.map((item, index) => {
            console.log(item[index]);
            todoApi.delTodo(index).then(msg => {
                if (msg = 'succeed') {
                    //console.log(lis);
                    console.log(todo.length);
                }
            })
        })
    </script>
</body>

</html>